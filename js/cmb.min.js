window.CMB=(function(c,a,d,f){var b=c.cmb_l10;var e={formfield:"",idNumber:false,file_frames:{},};e.metabox=function(){if(e.$metabox){return e.$metabox;
}e.$metabox=d("table.cmb_metabox");return e.$metabox;};e.init=function(){e.log(b);var g=e.metabox();if(b.new_admin_style){g.find(".cmb-spinner img").hide();
}e.initPickers(g.find("input:text.cmb_timepicker"),g.find("input:text.cmb_datepicker"),g.find("input:text.cmb_colorpicker"));d("#ui-datepicker-div").wrap('<div class="cmb_element" />');
d(".cmb_metabox").on("change",".cmb_upload_file",function(){e.formfield=d(this).attr("id");d("#"+e.formfield+"_id").val("");}).on("click",".cmb_upload_button",e.handleMedia).on("click",".cmb_remove_file_button",e.handleRemoveMedia).on("click",".add-group-row",e.addGroupRow).on("click",".add-row-button",e.addAjaxRow).on("click",".remove-group-row",e.removeGroupRow).on("click",".remove-row-button",e.removeAjaxRow).on("keyup paste focusout",".cmb_oembed",e.maybeOembed);
setTimeout(e.resizeoEmbeds,500);d(c).on("resize",e.resizeoEmbeds);};e.handleMedia=function(h){h.preventDefault();var m=e.metabox();var n=d(this);e.formfield=n.prev("input").attr("id");
var g=d("#"+e.formfield);var o=g.attr("name");var i=true;var l=true;var j=n.hasClass("cmb_upload_list");if(e.formfield in e.file_frames){e.file_frames[e.formfield].open();
return;}e.file_frames[e.formfield]=wp.media.frames.file_frame=wp.media({title:m.find("label[for="+e.formfield+"]").text(),button:{text:b.upload_file},multiple:j?true:false});
var k={list:function(q){l=q.toJSON();g.val(l.url);d("#"+e.formfield+"_id").val(l.id);var p=[];d(l).each(function(){if(this.type&&this.type==="image"){i='<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'"><p><a href="#" class="cmb_remove_file_button" rel="'+e.formfield+"["+this.id+']">'+b.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" name="'+o+"["+this.id+']" value="'+this.url+'"></li>';
}else{i="<li>"+b.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+b.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+e.formfield+"["+this.id+']">'+b.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" name="'+o+"["+this.id+']" value="'+this.url+'"></li>';
}p.push(i);});d(p).each(function(){g.siblings(".cmb_media_status").slideDown().append(this);});},single:function(p){l=p.first().toJSON();g.val(l.url);d("#"+e.formfield+"_id").val(l.id);
if(l.type&&l.type==="image"){i='<div class="img_status"><img style="max-width: 350px; width: 100%; height: auto;" src="'+l.url+'" alt="'+l.filename+'" title="'+l.filename+'" /><p><a href="#" class="cmb_remove_file_button" rel="'+e.formfield+'">'+b.remove_image+"</a></p></div>";
}else{i=b.file+" <strong>"+l.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+l.url+'" target="_blank" rel="external">'+b.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+e.formfield+'">'+b.remove_file+"</a>)";
}g.siblings(".cmb_media_status").slideDown().html(i);}};e.file_frames[e.formfield].on("select",function(){var q=e.file_frames[e.formfield].state().get("selection");
var p=j?"list":"single";k[p](q);});e.file_frames[e.formfield].open();};e.handleRemoveMedia=function(g){g.preventDefault();var i=d(this);if(i.is(".attach_list .cmb_remove_file_button")){i.parents("li").remove();
return false;}e.formfield=i.attr("rel");var h=i.parents(".img_status");e.metabox().find("input#"+e.formfield).val("");e.metabox().find("input#"+e.formfield+"_id").val("");
if(!h.length){i.parents(".cmb_media_status").html("");}else{h.html("");}return false;};d.fn.cleanRow=function(g,h){var i=d(this);if(h){i.find(".cmb-repeat-table .repeat-row:not(:first-child)").remove();
}e.$focus=false;i.find('input:not([type="button"]),select,textarea,label').each(function(){var m=d(this);var j=m.attr("for");var l=m.next();var o={};if(j){o={"for":j.replace("_"+g,"_"+e.idNumber)};
}else{var p=m.attr("name");var k=p?p.replace(g,e.idNumber):"";var q=m.attr("id");var n=q?q.replace("_"+g,"_"+e.idNumber):"";o={id:n,name:k,value:"","data-iterator":e.idNumber,};
}m.removeAttr("checked").removeAttr("selected").removeClass("hasDatepicker").attr(o);e.$focus=e.$focus?e.$focus:m;});return this;};d.fn.newRowHousekeeping=function(){var g=d(this);
var i=g.find(".wp-picker-container");var h=g.find(".cmb_media_status");if(i.length){i.each(function(){var j=d(this).parent();j.html(j.find("input:text.cmb_colorpicker").attr("style",""));
});}if(h.length){h.empty();}return this;};e.afterRowInsert=function(g){if(e.$focus){e.$focus.focus();}e.initPickers(g.find("input:text.cmb_timepicker"),g.find("input:text.cmb_datepicker"),g.find("input:text.cmb_colorpicker"));
};e.addGroupRow=function(l){l.preventDefault();var m=d(this);var h=d("#"+m.data("selector"));var j=h.find(".repeatable-grouping").last();var i=parseInt(j.data("iterator"));
e.idNumber=i+1;var g=j.clone();g.newRowHousekeeping().cleanRow(i,true);var k=d('<tr class="repeatable-grouping" data-iterator="'+e.idNumber+'">'+g.html()+"</tr>");
j.after(k);e.afterRowInsert(k);if(h.find(".repeatable-grouping").length<=1){h.find(".remove-group-row").prop("disabled",true);}else{h.find(".remove-group-row").removeAttr("disabled");
}};e.addAjaxRow=function(g){g.preventDefault();var l=d(this);var m="#"+l.data("selector");var o=d(m);var h=o.find(".empty-row");var j=parseInt(h.find("[data-iterator]").data("iterator"));
e.idNumber=j+1;var k=h.clone();var n=k.find(".wp-picker-container");var i=k.find(".cmb_media_status");k.newRowHousekeeping().cleanRow(j);h.removeClass("empty-row").addClass("repeat-row");
h.after(k);e.afterRowInsert(k);};e.removeGroupRow=function(i){i.preventDefault();var k=d(this);var h=d("#"+k.data("selector"));var j=k.parents(".repeatable-grouping");
var g=h.find(".repeatable-grouping").length;if(g>1){j.remove();if(g<3){h.find(".remove-group-row").prop("disabled",true);}else{h.find(".remove-group-row").prop("disabled",false);
}}};e.removeAjaxRow=function(h){h.preventDefault();var j=d(this);var i=j.parents("tr");var g=j.parents(".cmb-repeat-table");if(g.find("tr").length>1){if(i.hasClass("empty-row")){i.prev().addClass("empty-row").removeClass("repeat-row");
}j.parents(".cmb-repeat-table tr").remove();}};e.initPickers=function(h,i,g){e.initTimePickers(h);e.initDatePickers(i);e.initColorPickers(g);};e.initTimePickers=function(g){if(!g.length){return;
}g.timePicker({startTime:"00:00",endTime:"23:59",show24Hours:false,separator:":",step:30});};e.initDatePickers=function(g){if(!g.length){return;}g.datepicker("destroy");
g.datepicker();};e.initColorPickers=function(g){if(!g.length){return;}if(typeof jQuery.wp==="object"&&typeof jQuery.wp.wpColorPicker==="function"){g.wpColorPicker();
}else{g.each(function(h){d(this).after('<div id="picker-'+h+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');
d("#picker-"+h).hide().farbtastic(d(this));}).focus(function(){d(this).next().show();}).blur(function(){d(this).next().hide();});}};e.maybeOembed=function(h){var j=d(this);
var i=h.type;var g={focusout:function(){setTimeout(function(){e.spinner(".postbox table.cmb_metabox",true);},2000);},keyup:function(){var k=function(m,l){return h.which<=l&&h.which>=m;
};if(k(48,90)||k(96,111)||k(8,9)||h.which==187||h.which==190){e.doAjax(j,h);}},paste:function(){setTimeout(function(){e.doAjax(j);},100);}};g[i]();};e.resizeoEmbeds=function(){e.metabox().each(function(){var i=d(this);
var k=i.parents(".inside");if(!k.length){return true;}var h=Math.round((k.width()*0.82)*0.97)-30;if(h>639){return true;}var j=i.find(".cmb-type-oembed .embed_status");
var g=j.children().not(".cmb_remove_wrapper");if(!g.length){return true;}g.each(function(){var o=d(this);var m=o.width();var p=o.height();var n=h;if(o.parents(".repeat-row").length){n=h-91;
}var l=Math.round((n*p)/m);o.width(n).height(l);});});};e.log=function(){if(b.script_debug&&console&&typeof console.log==="function"){console.log.apply(console,arguments);
}};e.spinner=function(g,h){if(h){d(".cmb-spinner",g).hide();}else{d(".cmb-spinner",g).show();}};e.doAjax=function(n,m){var i=n.val();if(i.length<6){return;
}var k=n.attr("id");var g=n.parents(".cmb-repeat-table  tr td");g=g.length?g:n.parents(".cmb_metabox tr td");var l=d(".embed_status",g);var h=n.width();
var j=d(":first-child",l);e.log("oembed_url",i,k);h=(l.length&&j.length)?j.width():n.width();e.spinner(g);d(".embed_wrap",g).html("");setTimeout(function(){if(d(".cmb_oembed:focus").val()!=i){return;
}d.ajax({type:"post",dataType:"json",url:b.ajaxurl,data:{action:"cmb_oembed_handler",oembed_url:i,oembed_width:h>300?h:300,field_id:k,object_id:n.data("objectid"),object_type:n.data("objecttype"),cmb_ajax_nonce:b.ajax_nonce},success:function(o){e.log(o);
if(typeof o.id==="undefined"){return;}e.spinner(g,true);d(".embed_wrap",g).html(o.result);}});},500);};d(a).ready(e.init);return e;})(window,document,jQuery);
